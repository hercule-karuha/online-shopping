import{_ as F,g as S,u as h,A as z,b as B,r as u,e as O,h as j,o as J,c as L,i as I,l,m as r,a as A,y as M,z as T,E as G}from"./index-43945a83.js";import{E as H,a as K,b as Q}from"./el-form-item-a39e9bf3.js";import"./el-input-853da7da.js";import"./el-popper-a281cd70.js";import"./el-checkbox-4dbd9916.js";import"./el-radio-8b78f2fb.js";import{E as W}from"./el-input-number-57ff7060.js";import{_ as X,E as Y}from"./CoverUpload-1632b343.js";import{r as Z,m as _,e as $}from"./request-d304319d.js";import{a as ee,e as ae,n as te}from"./product-252d41f2.js";import{p as le}from"./tools-e8160517.js";import{s as oe}from"./element-china-area-data-7e4514d6.js";const se=async n=>await Z({url:"/file/uploadImage",method:"post",data:n});const re=n=>(M("data-v-1157bb37"),n=n(),T(),n),de={class:"content"},ue=re(()=>I("div",{class:"header"},"新品",-1)),ne={__name:"ProductEditor",setup(n){const U=oe,{proxy:b}=S(),i=h(),g=z(),V=B(),p=u(!1),y=u(null),t=u({detailImages:[]}),w=o=>{t.value.cover=o};u(!1);const x=u(null),R=async o=>{const e=new FormData;e.append("image",o.file);const a=await se(e);if(!a)return _.error("上传失败"),Promise.reject();t.value.detailImages.push(a.data.path)},f=u({}),v=u([]);O(async()=>{if((!V.userInfo||!V.userInfo.userType)&&i.push("/"),g.path.includes("/edit")){g.params.id||i.go(-1);const o=await ee(g.params.id);o||i.go(-1),p.value=!0,f.value=o.data;const e=o.data,a=JSON.parse(e.address);e.detailImages=e.detailImages.split(","),v.value=e.detailImages.map(d=>({url:b.globalInfo.imgUrl+d})),t.value={name:e.productName,description:e.description,price:e.price,stock:e.stock,selectedRegion:a.codeArr,detailAddress:a.detailAddress,detailImages:e.detailImages}}});const D=(o,e)=>{const a=e.indexOf(o);console.log(a),t.value.detailImages.splice(a,1)},k={name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:1,max:40,message:"长度在 1 到 40 个字符",trigger:"blur"}],cover:[{validator:(o,e,a)=>{!t.value.cover&&!p.value?a(new Error("请上传商品封面")):a()},trigger:"blur"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"},{min:1,max:200,message:"长度在 1 到 200 个字符",trigger:"blur"}],price:[{required:!0,message:"请输入商品单价",trigger:"blur"}],stock:[{required:!0,message:"请输入商品库存",trigger:"blur"},{validator:(o,e,a)=>{e<0?a(new Error("请输入大于0的数字")):a()},trigger:"blur"}],selectedRegion:[{required:!0,message:"请选择发货地址"}],detailAddress:[{required:!0,message:"请输入详细地址",trigger:"change"}]},C=async()=>{y.value.validate(async o=>{if(!o)return!1;const e=t.value.detailImages.join(","),a=new FormData;a.append("name",t.value.name),a.append("description",t.value.description),a.append("detailImages",e),a.append("price",t.value.price),a.append("stock",t.value.stock),(!p.value||t.value.cover instanceof File)&&a.append("cover",t.value.cover);const d=le(t.value.selectedRegion);let m={codeArr:t.value.selectedRegion,areaArr:d,detailAddress:t.value.detailAddress};if(m=JSON.stringify(m),a.append("address",m),p.value){if(a.append("productId",g.params.id),!await ae(a))return;_.success("修改成功"),i.go(-1)}else{const c=await te(a);if(!c)return;_.success("上传成功"),i.replace("/product/detail/"+c.data.productId)}})};return(o,e)=>{const a=K,d=$,m=j("Plus"),c=G,P=Y,E=W,q=Q,N=H;return J(),L("main",null,[I("div",de,[ue,l(N,{model:t.value,ref_key:"formDataRef",ref:y,rules:k,class:"form","label-position":"top","status-icon":""},{default:r(()=>[l(a,{label:"请上传你的商品封面",prop:"cover"},{default:r(()=>[l(X,{onUploadImage:w,imageUrl:f.value.productId?A(b).globalInfo.productCoverUrl+f.value.productId:"",update:p.value},null,8,["imageUrl","update"])]),_:1}),l(a,{label:"请输入你的商品名称",prop:"name"},{default:r(()=>[l(d,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.name=s),type:"text",clearable:""},null,8,["modelValue"])]),_:1}),l(a,{label:"请输入你的商品描述",prop:"description"},{default:r(()=>[l(d,{modelValue:t.value.description,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.description=s),maxlength:200,"show-word-limit":"",type:"textarea",clearable:""},null,8,["modelValue"])]),_:1}),l(a,{class:"detail-images-form-item",label:"请上传商品详情图片"},{default:r(()=>[l(P,{ref_key:"uploadDetailImagesRef",ref:x,class:"upload-detail-images","before-remove":D,multiple:"","list-type":"picture-card","http-request":R,"file-list":v.value,"onUpdate:fileList":e[2]||(e[2]=s=>v.value=s)},{default:r(()=>[l(c,null,{default:r(()=>[l(m)]),_:1})]),_:1},8,["file-list"])]),_:1}),l(a,{label:"请输入你的商品单价",prop:"price"},{default:r(()=>[l(E,{size:"large",modelValue:t.value.price,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.price=s),precision:2,step:.1},null,8,["modelValue"])]),_:1}),l(a,{label:"请输入你的库存量",prop:"stock"},{default:r(()=>[l(E,{modelValue:t.value.stock,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.stock=s),size:"large"},null,8,["modelValue"])]),_:1}),l(a,{label:"请选择你的发货区县",prop:"selectedRegion"},{default:r(()=>[l(q,{options:A(U),modelValue:t.value.selectedRegion,"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.selectedRegion=s)},null,8,["options","modelValue"])]),_:1}),l(a,{prop:"detailAddress",label:"请输入详细地址"},{default:r(()=>[l(d,{modelValue:t.value.detailAddress,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.detailAddress=s),type:"text",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),I("button",{onClick:C},"确认")])])}}},Ue=F(ne,[["__scopeId","data-v-1157bb37"]]);export{Ue as default};
