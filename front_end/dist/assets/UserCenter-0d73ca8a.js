import{_ as B,g as z,b as M,A as J,u as O,$ as T,r as w,h as m,o as v,c as j,i as s,a as n,t as G,C as V,m as r,l as o,x as g,j as b,E as H}from"./index-43945a83.js";import{a as K,b as L,E as P}from"./el-form-item-a39e9bf3.js";import"./el-input-853da7da.js";import"./el-popper-a281cd70.js";import"./el-checkbox-4dbd9916.js";import{a as Q,E as W}from"./el-radio-8b78f2fb.js";/* empty css                       */import{_ as X}from"./CoverUpload-1632b343.js";import{D as Y}from"./DialogModule-26653baa.js";import{p as Z}from"./tools-e8160517.js";import{m as ee,e as ae}from"./request-d304319d.js";import{s as oe}from"./element-china-area-data-7e4514d6.js";import{editUserInfo as se,getDetailUserInfo as te}from"./user-f47ffe26.js";const re={class:"info"},le={class:"avatar"},ne=["src"],ue={class:"name"},de={class:"tabs"},ie={class:"content"},pe={class:"dialog-body"},me={__name:"UserCenter",setup(ce){const{proxy:C}=z(),y=oe,d=M();console.log(d.userinfo);const c=J(),A=O(),u=T({show:!1,title:"编辑个人信息",buttons:[{text:"取消",type:"default",click:()=>{u.show=!1}},{text:"确定",type:"primary",click:async()=>{if(!I.value.validate())return;const t=new FormData;e.value.avatar&&t.append("avatar",e.value.avatar),t.append("userName",e.value.userName),t.append("gender",e.value.gender),t.append("phone",e.value.phone),t.append("address",JSON.stringify({codeArr:e.value.area,areaArr:Z(e.value.area),detailAddress:e.value.detailAddress})),await se(t)&&(ee.success("修改成功"),u.show=!1)}}]}),I=w(null),e=w({}),E=async()=>{const t=await te();if(!t)return;const a=t.data;e.value.userName=a.userName,e.value.gender=a.sex,e.value.phone=a.phone;const p=JSON.parse(a.address);e.value.area=p.codeArr,e.value.detailAddress=p.detailAddress,u.show=!0},k=t=>{e.value.cover=t},_=t=>{A.replace(t)},x={userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],area:[{required:!0,message:"请选择地区",trigger:"blur"}],detailAddress:[{required:!0,message:"请输入详细地址",trigger:"blur"}]};return(t,a)=>{const p=m("Male"),f=H,N=m("Female"),D=m("Edit"),F=m("router-view"),R=X,i=K,U=Q,$=W,h=ae,q=L,S=P;return v(),j("main",null,[s("header",null,[s("div",re,[s("div",le,[s("img",{src:n(C).globalInfo.avatarUrl+n(d).userInfo.userId,alt:""},null,8,ne)]),s("div",ue,[s("span",null,G(n(d).userInfo.userName),1),s("span",null,[n(d).userInfo.sex==1?(v(),V(f,{key:0},{default:r(()=>[o(p)]),_:1})):(v(),V(f,{key:1},{default:r(()=>[o(N)]),_:1}))])]),s("span",{class:"edit",onClick:E},[o(f,null,{default:r(()=>[o(D)]),_:1}),g("编辑个人信息")])]),s("nav",null,[s("ul",de,[s("li",null,[s("a",{onClick:a[0]||(a[0]=l=>_("/user/shoppingCart")),class:b([n(c).name=="shoppingCart"?"active_tab":""])},"购物车",2)]),s("li",null,[s("a",{onClick:a[1]||(a[1]=l=>_("/user/order")),class:b([n(c).name=="order"?"active_tab":""])},"购买记录",2)]),s("li",null,[s("a",{onClick:a[2]||(a[2]=l=>_("/user/stores")),class:b([n(c).name=="stores"?"active_tab":""])},"我的店铺",2)])])])]),s("div",ie,[o(F)]),o(Y,{show:u.show,title:u.title,onClose:a[7]||(a[7]=l=>u.show=!1),showCancel:!1,buttons:u.buttons},{default:r(()=>[s("div",pe,[o(S,{ref_key:"formDataRef",ref:I,model:e.value,rules:x,"label-position":"top"},{default:r(()=>[o(i,{label:"请上传你的头像",prop:"avatar"},{default:r(()=>[o(R,{onUploadImage:k,imageUrl:n(d).userInfo.userId?n(C).globalInfo.avatarUrl+n(d).userInfo.userId:"",update:!0},null,8,["imageUrl"])]),_:1}),o(i,{label:"性别",prop:"gender"},{default:r(()=>[o($,{modelValue:e.value.gender,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.gender=l),class:"ml-4"},{default:r(()=>[o(U,{label:"1",size:"large"},{default:r(()=>[g("男")]),_:1}),o(U,{label:"2",size:"large"},{default:r(()=>[g("女")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"手机号",prop:"phone"},{default:r(()=>[o(h,{modelValue:e.value.phone,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.phone=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"默认收货地区",prop:"area"},{default:r(()=>[o(q,{options:n(y),modelValue:e.value.area,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.area=l)},null,8,["options","modelValue"])]),_:1}),o(i,{label:"默认详细地址",prop:"detailAddress"},{default:r(()=>[o(h,{modelValue:e.value.detailAddress,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.detailAddress=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["show","title","buttons"])])}}},Ee=B(me,[["__scopeId","data-v-016e1fa6"]]);export{Ee as default};
